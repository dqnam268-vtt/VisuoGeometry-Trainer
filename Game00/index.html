<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Thi√™n C∆° B·∫£ng - K·∫øt ·∫§n (Hand Gesture)</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
    <script crossorigin="anonymous" src="https://unpkg.com/@mediapipe/hands@0.4.1675469240/hands.js"></script>
    
    <!-- Fonts (D√πng Merriweather ƒë·ªÉ h·ªó tr·ª£ Ti·∫øng Vi·ªát t·ªët nh·∫•t) -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Merriweather:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { margin: 0; overflow: hidden; background: #050505; font-family: 'Merriweather', serif; user-select: none; }
        
        #input-video {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; transform: scaleX(-1); z-index: 0;
            opacity: 0.25; mix-blend-mode: hard-light; filter: contrast(1.1) grayscale(0.4);
        }

        /* Theme Tu Ti√™n */
        .glass-panel {
            background: rgba(10, 5, 20, 0.8);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.2), inset 0 0 50px rgba(0, 0, 0, 0.9);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 16px;
            backdrop-filter: blur(10px);
        }

        .title-font { font-family: 'Cinzel Decorative', cursive; letter-spacing: 2px; text-shadow: 0 0 10px #d4af37; }

        /* Hi·ªáu ·ª©ng t·ª• l·ª±c khi gi∆° tay */
        .casting-circle {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 300px; height: 300px; pointer-events: none; z-index: 40;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        
        .magic-rune {
            font-size: 120px; font-weight: 900; color: #00ffff;
            text-shadow: 0 0 30px #00ffff, 0 0 60px blue;
            animation: pulseRune 1s infinite alternate;
        }

        .progress-bar-container {
            width: 200px; height: 10px; background: rgba(255,255,255,0.1);
            border-radius: 5px; margin-top: 20px; overflow: hidden; border: 1px solid #333;
        }
        .progress-bar-fill {
            height: 100%; background: linear-gradient(90deg, #00ffff, #fff);
            width: 0%; transition: width 0.1s linear;
            box-shadow: 0 0 10px cyan;
        }

        @keyframes pulseRune { from {transform: scale(1); opacity: 0.8;} to {transform: scale(1.1); opacity: 1;} }

        /* Danh s√°ch n√∫t (ch·ªâ ƒë·ªÉ hi·ªÉn th·ªã, kh√¥ng c·∫ßn hover n·ªØa) */
        .dharma-card {
            background: rgba(0,0,0,0.6); border: 1px solid #444; color: #888;
            transition: all 0.3s;
        }
        .dharma-card.active {
            border-color: #00ffff; color: #00ffff; background: rgba(0, 255, 255, 0.1);
            transform: scale(1.1) translateY(-10px);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }

        .winner-card {
            background: rgba(20, 0, 0, 0.9); border: 2px solid gold;
            box-shadow: 0 0 30px gold;
            animation: floatItem 3s ease-in-out infinite;
        }
        @keyframes floatItem { 0%, 100% {transform: translateY(0px);} 50% {transform: translateY(-10px);} }

    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- √ÇM THANH ---
        const playSound = (type) => {
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (!AudioContext) return;
                const audioCtx = new AudioContext();
                const osc = audioCtx.createOscillator(); 
                const gain = audioCtx.createGain();
                const now = audioCtx.currentTime;
                
                osc.connect(gain); gain.connect(audioCtx.destination);
                
                if(type === 'charge') {
                    // Ti·∫øng t·ª• l·ª±c (Low hum rising)
                    osc.frequency.setValueAtTime(100, now);
                    osc.frequency.linearRampToValueAtTime(300, now + 0.1);
                    gain.gain.setValueAtTime(0.05, now);
                    gain.gain.linearRampToValueAtTime(0, now + 0.1);
                    osc.start(now); osc.stop(now + 0.1);
                } else if (type === 'activate') {
                    // Ti·∫øng k√≠ch ho·∫°t (Magic chime)
                    osc.type = 'triangle';
                    osc.frequency.setValueAtTime(400, now);
                    osc.frequency.exponentialRampToValueAtTime(800, now + 0.1);
                    gain.gain.setValueAtTime(0.2, now);
                    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
                    osc.start(now); osc.stop(now + 0.5);
                } else if (type === 'win') {
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(523.25, now); // C5
                    gain.gain.setValueAtTime(0.1, now);
                    gain.gain.exponentialRampToValueAtTime(0.001, now + 1.5);
                    osc.start(now); osc.stop(now + 1.5);
                }
            } catch(e) { console.warn("Audio error", e); }
        };

        // --- 3D SCENE ---
        const ThreeScene = ({ studentList, isSpinning }) => {
            const containerRef = useRef(null);
            const sceneRef = useRef({ scene: null, camera: null, renderer: null, group: null });

            useEffect(() => {
                if(!containerRef.current) return;
                const w = window.innerWidth;
                const h = window.innerHeight;
                const scene = new THREE.Scene();
                scene.fog = new THREE.FogExp2(0x050505, 0.06);

                const camera = new THREE.PerspectiveCamera(75, w/h, 0.1, 100);
                camera.position.z = 8;

                const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
                renderer.setSize(w, h);
                containerRef.current.innerHTML = '';
                containerRef.current.appendChild(renderer.domElement);

                // Particles (Linh Kh√≠)
                for(let i=0; i<80; i++) {
                    const geo = new THREE.OctahedronGeometry(0.1, 0);
                    const mat = new THREE.MeshBasicMaterial({ color: Math.random() > 0.5 ? 0x00ffff : 0xffd700, transparent: true, opacity: 0.6 });
                    const mesh = new THREE.Mesh(geo, mat);
                    mesh.position.set((Math.random()-0.5)*20, (Math.random()-0.5)*20, (Math.random()-0.5)*15);
                    mesh.userData = { speedY: Math.random()*0.03 + 0.01, speedRot: Math.random()*0.05 };
                    scene.add(mesh);
                }

                const group = new THREE.Group();
                scene.add(group);
                sceneRef.current = { scene, camera, renderer, group };

                const animate = () => {
                    requestAnimationFrame(animate);
                    scene.children.forEach(child => {
                        if(child.userData.speedY) {
                            child.position.y += child.userData.speedY;
                            child.rotation.x += child.userData.speedRot;
                            if(child.position.y > 10) child.position.y = -10;
                        }
                    });
                    if(group) {
                        group.rotation.y += isSpinning ? 0.35 : 0.002;
                        group.rotation.x = Math.sin(Date.now() * 0.0005) * 0.05;
                    }
                    renderer.render(scene, camera);
                };
                animate();

                const handleResize = () => {
                    renderer.setSize(window.innerWidth, window.innerHeight);
                    camera.aspect = window.innerWidth/window.innerHeight;
                    camera.updateProjectionMatrix();
                };
                window.addEventListener('resize', handleResize);
                return () => window.removeEventListener('resize', handleResize);
            }, []);

            // Update Labels
            useEffect(() => {
                const { group } = sceneRef.current;
                if(!group) return;
                while(group.children.length > 0) group.remove(group.children[0]); 

                studentList.forEach((name, i) => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = 1024; canvas.height = 256;
                    
                    // FONT FIX: D√πng font stack an to√†n v√† Font Merriweather
                    ctx.font = 'bold 70px "Merriweather", "Times New Roman", serif';
                    ctx.fillStyle = '#ffd700';
                    ctx.textAlign = 'center';
                    ctx.shadowColor = '#d63384'; ctx.shadowBlur = 15;
                    ctx.fillText(name, 512, 128);
                    
                    const texture = new THREE.CanvasTexture(canvas);
                    const sprite = new THREE.Sprite(new THREE.SpriteMaterial({ map: texture, transparent: true }));
                    sprite.scale.set(6, 1.5, 1);
                    
                    const angle = (i / studentList.length) * Math.PI * 2;
                    const r = 10;
                    sprite.position.set(Math.cos(angle)*r, (Math.random()-0.5)*6, Math.sin(angle)*r);
                    group.add(sprite);
                });
            }, [studentList]);

            return <div ref={containerRef} className="absolute inset-0 z-0" />;
        };

        function App() {
            // Data
            const [studentList, setStudentList] = useState([
                "Nguy·ªÖn V≈© Thu An", "Tr·∫ßn Ph√∫c An", "Nguy·ªÖn Ng·ªçc Th·ª•y Anh", "Nguy·ªÖn Vi·ªát Anh", 
                "Ph·∫°m Di·ªáu Anh", "Phan Nh·∫≠t √Çn", "V≈© Y·∫øn Chi", "H√πng C√¥ng Danh", "ƒê√†o Minh D≈©ng", 
                "Nguy·ªÖn L√™ Tr·∫°ch ƒê√¥ng", "Phan Ng·ªçc Khoa", "Nguy·ªÖn L√™ Minh Kh√¥i", "T·∫° Tu·∫•n Ki·ªát", 
                "ƒêinh Phan Thi√™n Kim", "Ng√¥ B·∫£o T√∫ Linh", "Nguy·ªÖn Tr·∫ßn Linh Ng√¢n", "V≈© B·∫£o Ng√¢n", 
                "Nguy·ªÖn Ph√∫c Kh√¥i Nguy√™n", "ƒê·ªó Kh·∫Øc Minh Nh·∫≠t", "L√™ Ng·ªçc An Nhi√™n", "Tr·∫ßn Quang Ninh", 
                "Nguy·ªÖn H√† Minh Ph√°t", "ƒê·ªó Ho√†ng Qu√¢n", "Nguy·ªÖn Th·ªã Minh T√¢m", "Tr·∫ßn Ph·∫°m Qu·ªëc Th·∫Øng", 
                "Phan Ti·∫øn Th·ªãnh", "T√¥ Vƒ©nh Th·ª•y", "Tr·∫ßn L√™ Gia Tu·ªá", "Tr·∫ßn H·ªØu Vi·ªát", "Ph√≠ Ng·ªçc Kh√°nh Vy"
            ]);
            
            const [appState, setAppState] = useState("INIT");
            const [isSpinning, setIsSpinning] = useState(false);
            const [winners, setWinners] = useState([]);
            const [errorMsg, setErrorMsg] = useState("");
            const [useCamera, setUseCamera] = useState(true);

            // Gesture State
            const [detectedFingers, setDetectedFingers] = useState(0);
            const [isHolding, setIsHolding] = useState(false);
            const [chargeProgress, setChargeProgress] = useState(0);

            const videoRef = useRef(null);
            const logicRef = useRef({ 
                lastFingerCount: 0, 
                holdStartTime: 0, 
                isProcessing: false,
                requiredHoldTime: 1500 // 1.5 gi√¢y ƒë·ªÉ ch·ªët
            });

            const startSystem = async (enableCam) => {
                setAppState("LOADING");
                setUseCamera(enableCam);
                if(!enableCam) { setAppState("READY"); return; } // Mouse mode simple

                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
                    if (videoRef.current) {
                        videoRef.current.srcObject = stream;
                        await videoRef.current.play();
                    }
                    
                    if (window.Hands) {
                        const hands = new window.Hands({locateFile: (f) => `https://unpkg.com/@mediapipe/hands@0.4.1675469240/${f}`});
                        hands.setOptions({maxNumHands: 1, minDetectionConfidence: 0.6, minTrackingConfidence: 0.5});
                        hands.onResults(onHandResults);
                        
                        const processVideo = async () => {
                            if (appState === "ERROR") return;
                            if (videoRef.current && videoRef.current.readyState >= 2 && !logicRef.current.isProcessing) {
                                logicRef.current.isProcessing = true;
                                await hands.send({image: videoRef.current});
                                logicRef.current.isProcessing = false;
                            }
                            requestAnimationFrame(processVideo);
                        };
                        processVideo();
                    }
                    setAppState("READY");
                } catch (err) {
                    setErrorMsg("Kh√¥ng m·ªü ƒë∆∞·ª£c Camera. Chuy·ªÉn sang ch·∫ø ƒë·ªô Chu·ªôt.");
                    setUseCamera(false);
                    setAppState("READY");
                }
            };

            // --- THU·∫¨T TO√ÅN ƒê·∫æM NG√ìN TAY ---
            const countFingers = (landmarks) => {
                // Landmarks: 8(Index), 12(Middle), 16(Ring), 20(Pinky)
                // Joints: 6, 10, 14, 18 (PIP - kh·ªõp gi·ªØa)
                let count = 0;
                
                // 1. Ki·ªÉm tra 4 ng√≥n d√†i (cao h∆°n kh·ªõp gi·ªØa l√† m·ªü)
                if (landmarks[8].y < landmarks[6].y) count++;
                if (landmarks[12].y < landmarks[10].y) count++;
                if (landmarks[16].y < landmarks[14].y) count++;
                if (landmarks[20].y < landmarks[18].y) count++;
                
                // 2. Ki·ªÉm tra ng√≥n c√°i (Thumb - 4)
                // ƒê∆°n gi·∫£n h√≥a: So s√°nh kho·∫£ng c√°ch ng√≥n c√°i v·ªõi kh·ªõp ng√≥n tr·ªè (5)
                // N·∫øu ng√≥n c√°i xa ng√≥n tr·ªè theo tr·ª•c X => M·ªü
                // Ho·∫∑c check t·ªça ƒë·ªô X so v·ªõi kh·ªõp 3 (IP)
                // Logic: Tay ph·∫£i (trong g∆∞∆°ng l√† tr√°i), ng√≥n c√°i ·ªü b√™n tr√°i.
                // ƒê·ªÉ ƒë∆°n gi·∫£n v√† ch√≠nh x√°c: Check kho·∫£ng c√°ch t·ª´ ƒê·ªânh ng√≥n c√°i (4) ƒë·∫øn G·ªëc ng√≥n √∫t (17)
                // N·∫øu xa th√¨ l√† m·ªü, g·∫ßn l√† n·∫Øm.
                const distThumb = Math.sqrt(Math.pow(landmarks[4].x - landmarks[17].x, 2) + Math.pow(landmarks[4].y - landmarks[17].y, 2));
                const distIndex = Math.sqrt(Math.pow(landmarks[8].x - landmarks[17].x, 2) + Math.pow(landmarks[8].y - landmarks[17].y, 2));
                
                // Ng√≥n c√°i th∆∞·ªùng ng·∫Øn h∆°n, nh∆∞ng khi m·ªü r·ªông n√≥ s·∫Ω c√°ch xa l√≤ng b√†n tay.
                // C√°ch ƒë∆°n gi·∫£n nh·∫•t cho ng∆∞·ªùi d√πng: Gi∆° ng√≥n c√°i sang ngang.
                // Heuristic: N·∫øu x c·ªßa 4 n·∫±m ngo√†i x c·ªßa 3 (xa t√¢m b√†n tay h∆°n)
                // D√πng logic: N·∫øu ng√≥n c√°i m·ªü, count++
                // T·∫°m th·ªùi fix c·ª©ng: Gi∆° ng√≥n c√°i th∆∞·ªùng ƒëi k√®m c√°c ng√≥n kh√°c. 
                // N·∫øu 4 ng√≥n kia ƒë√≥ng, m√† ng√≥n c√°i m·ªü -> S·ªë 1 (Like).
                // N·∫øu 4 ng√≥n kia m·ªü, ng√≥n c√°i m·ªü -> S·ªë 5.
                // Check thumb m·ªü:
                const isThumbOpen = (landmarks[4].x < landmarks[3].x && landmarks[5].x < landmarks[17].x) || (landmarks[4].x > landmarks[3].x && landmarks[5].x > landmarks[17].x); 
                // Logic tr√™n check xem 4 c√≥ n·∫±m "ngo√†i" 3 kh√¥ng.
                if(isThumbOpen) count++;
                
                // Gi·ªõi h·∫°n max 5
                return Math.min(count, 5);
            };

            const onHandResults = (results) => {
                if (!results.multiHandLandmarks || results.multiHandLandmarks.length === 0) {
                    resetGesture();
                    return;
                }
                
                // ƒê·∫øm ng√≥n
                const lm = results.multiHandLandmarks[0];
                const fingers = countFingers(lm);
                
                // Logic gi·ªØ y√™n (Debounce & Hold)
                processGesture(fingers);
            };

            const resetGesture = () => {
                setDetectedFingers(0);
                setIsHolding(false);
                setChargeProgress(0);
                logicRef.current.lastFingerCount = 0;
                logicRef.current.holdStartTime = 0;
            };

            const processGesture = (fingers) => {
                if (appState !== "READY" || isSpinning || winners.length > 0) return;

                const now = Date.now();
                
                // Ch·ªâ ch·∫•p nh·∫≠n s·ªë t·ª´ 1 ƒë·∫øn 5
                if (fingers === 0) {
                    resetGesture();
                    return;
                }

                if (fingers !== logicRef.current.lastFingerCount) {
                    // S·ªë ng√≥n thay ƒë·ªïi -> Reset timer
                    logicRef.current.lastFingerCount = fingers;
                    logicRef.current.holdStartTime = now;
                    setDetectedFingers(fingers);
                    setChargeProgress(0);
                    playSound('charge'); // √Çm thanh b·∫Øt ƒë·∫ßu t·ª• l·ª±c
                } else {
                    // S·ªë ng√≥n ·ªïn ƒë·ªãnh -> T√≠nh ti·∫øn ƒë·ªô
                    const elapsed = now - logicRef.current.holdStartTime;
                    const progress = Math.min((elapsed / logicRef.current.requiredHoldTime) * 100, 100);
                    setChargeProgress(progress);
                    setIsHolding(true);

                    if (progress >= 100) {
                        // K√≠ch ho·∫°t!
                        triggerGift(fingers);
                        resetGesture(); // Reset sau khi k√≠ch ho·∫°t
                    }
                }
            };

            const triggerGift = (count) => {
                if(studentList.length < count) { alert("Kh√¥ng ƒë·ªß ƒë·∫°o h·ªØu!"); return; }
                playSound('activate');
                setIsSpinning(true);
                
                setTimeout(() => {
                    const pool = [...studentList];
                    const selected = [];
                    for(let i=0; i<count; i++) {
                        const idx = Math.floor(Math.random() * pool.length);
                        selected.push(pool[idx]); pool.splice(idx, 1);
                    }
                    setWinners(selected);
                    setIsSpinning(false);
                    playSound('win');
                }, 3000);
            };

            return (
                <div className="w-full h-full relative">
                    {useCamera && <video ref={videoRef} playsInline muted id="input-video"></video>}
                    <ThreeScene studentList={studentList} isSpinning={isSpinning} />

                    {/* UI LAYER */}
                    <div className="absolute inset-0 z-50 pointer-events-none flex flex-col items-center justify-center p-4">
                        
                        {/* HEADER */}
                        <div className="absolute top-0 w-full p-4 flex justify-between items-start pointer-events-none">
                            <div className="glass-panel px-6 py-2 pointer-events-auto">
                                <h1 className="text-3xl title-font text-yellow-500">Thi√™n C∆° B·∫£ng</h1>
                                <p className="text-sm text-cyan-200">T·ªïng: {studentList.length} ƒê·∫°o H·ªØu</p>
                            </div>
                        </div>

                        {/* HI·ªÇN TH·ªä TR·∫†NG TH√ÅI K·∫æT ·∫§N (CH√çNH GI·ªÆA) */}
                        {appState === "READY" && !isSpinning && winners.length === 0 && useCamera && detectedFingers > 0 && (
                            <div className="casting-circle animate__animated animate__fadeIn">
                                <div className="text-cyan-300 text-lg font-bold mb-2 uppercase tracking-widest text-shadow">K·∫øt ·∫§n</div>
                                <div className="magic-rune">{detectedFingers}</div>
                                <div className="progress-bar-container">
                                    <div className="progress-bar-fill" style={{width: `${chargeProgress}%`}}></div>
                                </div>
                                <p className="text-white text-xs mt-2 opacity-80">Gi·ªØ y√™n tay...</p>
                            </div>
                        )}

                        {/* H∆Ø·ªöNG D·∫™N HO·∫∂C CH·ªú */}
                        {appState === "READY" && !isSpinning && winners.length === 0 && (
                            <div className="absolute bottom-10 flex flex-col items-center animate__animated animate__fadeInUp">
                                {!useCamera ? (
                                    <div className="glass-panel p-4 flex gap-4 pointer-events-auto">
                                        {[1, 2, 3, 4, 5].map(n => (
                                            <button key={n} onClick={()=>triggerGift(n)} className="w-12 h-12 rounded bg-gray-800 border border-gray-600 hover:bg-cyan-900 hover:border-cyan-400 text-white font-bold text-xl transition-all">
                                                {n}
                                            </button>
                                        ))}
                                    </div>
                                ) : (
                                    <div className="glass-panel px-6 py-3 text-center">
                                        <p className="text-yellow-400 text-lg font-bold mb-1">
                                            {detectedFingers === 0 ? "‚úã H√£y gi∆° ng√≥n tay l√™n tr∆∞·ªõc Camera" : "‚úä ƒêang t·ª• linh kh√≠..."}
                                        </p>
                                        <p className="text-gray-400 text-xs">Gi∆° 1 ng√≥n = Ch·ªçn 1 ng∆∞·ªùi, 2 ng√≥n = 2 ng∆∞·ªùi...</p>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* K·∫æT QU·∫¢ QUAY */}
                        {isSpinning && (
                            <div className="text-center animate__animated animate__pulse animate__infinite z-50">
                                <div className="text-8xl mb-4 opacity-80" style={{filter: 'drop-shadow(0 0 20px cyan)'}}>‚òØÔ∏è</div>
                                <div className="text-4xl title-font text-yellow-300">ƒêang V·∫≠n Chuy·ªÉn Thi√™n C∆°...</div>
                            </div>
                        )}

                        {winners.length > 0 && (
                            <div className="flex flex-col items-center animate__animated animate__zoomIn z-50 w-full max-w-5xl">
                                <h2 className="text-5xl title-font text-yellow-400 mb-10 drop-shadow-[0_0_15px_red]">ƒê·∫°i C∆° Duy√™n</h2>
                                <div className="flex flex-wrap justify-center gap-8 mb-10">
                                    {winners.map((w, i) => (
                                        <div key={i} className="winner-card px-8 py-6 rounded-lg text-center min-w-[240px]">
                                            <div className="text-5xl mb-4">üéÅ</div>
                                            <div className="text-3xl font-bold text-cyan-300 font-serif" style={{fontFamily: 'Merriweather'}}>{w}</div>
                                        </div>
                                    ))}
                                </div>
                                <div className="flex gap-6 pointer-events-auto">
                                    <button onClick={() => setWinners([])} className="px-8 py-3 bg-gray-800 border border-gray-500 text-gray-300 rounded hover:bg-gray-700 font-bold uppercase">Gi·ªØ L·∫°i</button>
                                    <button onClick={() => {
                                        setStudentList(prev => prev.filter(s => !winners.includes(s)));
                                        setWinners([]);
                                    }} className="px-8 py-3 bg-red-900 border border-red-500 text-white rounded hover:bg-red-700 shadow-[0_0_20px_red] font-bold uppercase">X√≥a T√™n & Ti·∫øp T·ª•c</button>
                                </div>
                            </div>
                        )}

                        {/* M√ÄN H√åNH CH·ªú BAN ƒê·∫¶U */}
                        {appState === "INIT" && (
                            <div className="glass-panel p-10 text-center max-w-lg pointer-events-auto border-2 border-yellow-600">
                                <h1 className="text-5xl title-font text-yellow-500 mb-2">Thi√™n C∆° B·∫£ng</h1>
                                <p className="text-gray-400 mb-8 italic">"V·∫°n s·ª± t√πy duy√™n, v·∫≠n kh√≠ do tr·ªùi"</p>
                                <div className="space-y-4">
                                    <button onClick={() => startSystem(true)} className="w-full py-4 bg-gradient-to-r from-cyan-900 to-blue-900 text-white border border-cyan-500 rounded hover:scale-105 transition-transform font-bold text-lg shadow-[0_0_15px_cyan]">
                                        <i className="fas fa-hand-sparkles mr-3"></i> K·∫øt ·∫§n (Camera)
                                    </button>
                                    <button onClick={() => startSystem(false)} className="w-full py-3 bg-transparent text-gray-400 border border-gray-700 rounded hover:bg-gray-800 font-bold">
                                        <i className="fas fa-mouse mr-3"></i> D√πng Chu·ªôt
                                    </button>
                                </div>
                            </div>
                        )}
                        
                        {/* M√ÄN H√åNH LOADING */}
                        {appState === "LOADING" && (
                            <div className="loading-overlay">
                                <div className="text-6xl animate-spin mb-6 text-cyan-500">üí†</div>
                                <div className="text-2xl text-yellow-500 font-serif">ƒêang khai m·ªü linh tr·∫≠n...</div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>