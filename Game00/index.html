<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Thi√™n C∆° B·∫£ng - Tu Ti√™n AR</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
    <script crossorigin="anonymous" src="https://unpkg.com/@mediapipe/hands@0.4.1675469240/hands.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Noto+Serif+SC:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Noto Serif SC', serif; }
        
        #input-video {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; transform: scaleX(-1); z-index: 0;
            opacity: 0.3; mix-blend-mode: screen; filter: contrast(1.2) sepia(0.3) hue-rotate(240deg);
        }

        #output-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; pointer-events: none; }

        /* Theme Styles - Tu Ti√™n */
        .theme-tien-hiep {
            background: radial-gradient(circle at center, #1a0b2e 0%, #000000 100%);
            color: #ffd700;
        }

        .glass-panel {
            background: rgba(20, 10, 40, 0.7);
            box-shadow: 0 0 15px rgba(138, 43, 226, 0.5), inset 0 0 20px rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 12px;
        }

        .title-font { font-family: 'Cinzel Decorative', cursive; letter-spacing: 2px; text-shadow: 0 0 10px #d4af37; }

        /* Spirit Cursor (Ng√≥n tay linh l·ª±c) */
        .spirit-cursor {
            position: fixed; pointer-events: none; z-index: 9999;
            width: 0; height: 0;
            box-shadow: 0 0 30px 15px rgba(0, 255, 255, 0.6);
            background: rgba(0, 255, 255, 1);
            border-radius: 50%;
            transition: transform 0.08s ease-out;
        }
        .spirit-cursor::after {
            content: ''; position: absolute; top: -10px; left: -10px; width: 20px; height: 20px;
            border: 2px solid cyan; border-radius: 50%;
            animation: spinTarget 2s linear infinite;
        }
        .spirit-cursor::before {
            content: ''; position: absolute; top: -20px; left: -20px; width: 40px; height: 40px;
            border: 1px dashed gold; border-radius: 50%;
            animation: spinTargetReverse 3s linear infinite;
        }

        @keyframes spinTarget { 0% {transform: rotate(0deg) scale(0.8);} 50% {transform: rotate(180deg) scale(1.2);} 100% {transform: rotate(360deg) scale(0.8);} }
        @keyframes spinTargetReverse { 0% {transform: rotate(360deg);} 100% {transform: rotate(0deg);} }

        /* Buttons as Dharma Arrays (Tr·∫≠n ph√°p) */
        .dharma-btn {
            position: relative;
            background: url('https://www.transparenttextures.com/patterns/black-scales.png'), linear-gradient(135deg, #2a1b3d, #000);
            border: 2px solid #5a3e7a;
            color: #d4af37;
            box-shadow: 0 0 10px #5a3e7a;
            transition: all 0.3s;
            clip-path: polygon(30% 0%, 70% 0%, 100% 30%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 0% 30%);
        }
        .dharma-btn.hovered {
            transform: scale(1.2) rotate(45deg);
            border-color: #00ffff;
            color: #00ffff;
            box-shadow: 0 0 30px cyan, inset 0 0 20px cyan;
        }
        .dharma-btn .btn-content {
            transition: transform 0.3s;
        }
        .dharma-btn.hovered .btn-content {
            transform: rotate(-45deg); /* Gi·ªØ s·ªë ƒë·ª©ng y√™n khi khung xoay */
        }
        
        /* Progress Ring (V√≤ng n·∫°p nƒÉng l∆∞·ª£ng) */
        .energy-fill {
            position: absolute; bottom: 0; left: 0; width: 100%; background: rgba(0, 255, 255, 0.3);
            transition: height 0.1s linear; mix-blend-mode: overlay;
        }

        /* Animations */
        @keyframes floatItem { 0% {transform: translateY(0px);} 50% {transform: translateY(-10px);} 100% {transform: translateY(0px);} }
        .gift-card { animation: floatItem 3s ease-in-out infinite; border: 1px solid gold; background: rgba(0,0,0,0.8); }

    </style>
</head>
<body class="theme-tien-hiep">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- H·ªÜ TH·ªêNG √ÇM THANH (D√πng Web Audio API) ---
        const playSound = (type) => {
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = audioCtx.createOscillator(); 
            const gain = audioCtx.createGain();
            const now = audioCtx.currentTime;
            
            osc.connect(gain); gain.connect(audioCtx.destination);
            
            if(type === 'hover') {
                // Ti·∫øng t√≠ch t·ª• linh kh√≠ (High pitched pulsing)
                osc.type = 'sine';
                osc.frequency.setValueAtTime(800, now);
                osc.frequency.exponentialRampToValueAtTime(1200, now + 0.1);
                gain.gain.setValueAtTime(0.05, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.1);
                osc.start(now); osc.stop(now + 0.1);
            } else if (type === 'select') {
                // Ti·∫øng thi tri·ªÉn ph√°p thu·∫≠t (Gong/Magic)
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(200, now);
                osc.frequency.linearRampToValueAtTime(600, now + 0.3);
                gain.gain.setValueAtTime(0.2, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
                osc.start(now); osc.stop(now + 0.5);
            } else if (type === 'win') {
                // Ti·∫øng Ti√™n nh·∫°c (Arpeggio)
                const notes = [523.25, 659.25, 783.99, 1046.50, 1318.51]; // C major chord
                notes.forEach((freq, i) => {
                    const osc2 = audioCtx.createOscillator();
                    const gain2 = audioCtx.createGain();
                    osc2.connect(gain2); gain2.connect(audioCtx.destination);
                    osc2.frequency.value = freq;
                    osc2.type = 'sine';
                    gain2.gain.setValueAtTime(0, now + i*0.1);
                    gain2.gain.linearRampToValueAtTime(0.1, now + i*0.1 + 0.05);
                    gain2.gain.exponentialRampToValueAtTime(0.001, now + i*0.1 + 1.5);
                    osc2.start(now + i*0.1); osc2.stop(now + i*0.1 + 1.5);
                });
            }
        };

        // --- 3D PARTICLE SYSTEM (LINH KH√ç) ---
        class SpiritParticle {
            constructor(scene) {
                const geometry = new THREE.IcosahedronGeometry(0.1, 0);
                const material = new THREE.MeshBasicMaterial({ 
                    color: Math.random() > 0.5 ? 0x00ffff : 0xffd700, // Cyan or Gold
                    transparent: true, opacity: 0.6, wireframe: true
                });
                this.mesh = new THREE.Mesh(geometry, material);
                this.reset();
                scene.add(this.mesh);
            }
            reset() {
                this.mesh.position.set((Math.random()-0.5)*15, -6, (Math.random()-0.5)*5);
                this.speed = Math.random() * 0.05 + 0.02;
                this.wobble = Math.random() * Math.PI;
            }
            update() {
                this.mesh.position.y += this.speed;
                this.mesh.position.x += Math.sin(this.mesh.position.y + this.wobble) * 0.02;
                this.mesh.rotation.x += 0.05;
                this.mesh.rotation.y += 0.05;
                if(this.mesh.position.y > 6) this.reset();
            }
        }

        // T·∫°o ch·ªØ 3D cho t√™n ƒë·∫°o h·ªØu
        const createNameSprite = (text) => {
            const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d');
            canvas.width = 1024; canvas.height = 256;
            // Font ch·ªØ ki·ªÉu th∆∞ ph√°p
            ctx.font = 'bold 70px "Noto Serif SC"'; 
            ctx.fillStyle = '#ffd700'; // V√†ng kim
            ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
            ctx.shadowColor = '#ff0000'; ctx.shadowBlur = 15; // H√†o quang ƒë·ªè/cam
            ctx.fillText(text, 512, 128);
            
            const texture = new THREE.CanvasTexture(canvas);
            const material = new THREE.SpriteMaterial({ map: texture, transparent: true, blending: THREE.AdditiveBlending });
            const sprite = new THREE.Sprite(material);
            sprite.scale.set(8, 2, 1);
            return sprite;
        };

        function App() {
            // Danh s√°ch m·∫∑c ƒë·ªãnh
            const [studentList, setStudentList] = useState([
                "Nguy·ªÖn V≈© Thu An", "Tr·∫ßn Ph√∫c An", "Nguy·ªÖn Ng·ªçc Th·ª•y Anh", "Nguy·ªÖn Vi·ªát Anh", 
                "Ph·∫°m Di·ªáu Anh", "Phan Nh·∫≠t √Çn", "V≈© Y·∫øn Chi", "H√πng C√¥ng Danh", "ƒê√†o Minh D≈©ng", 
                "Nguy·ªÖn L√™ Tr·∫°ch ƒê√¥ng", "Phan Ng·ªçc Khoa", "Nguy·ªÖn L√™ Minh Kh√¥i", "T·∫° Tu·∫•n Ki·ªát", 
                "ƒêinh Phan Thi√™n Kim", "Ng√¥ B·∫£o T√∫ Linh", "Nguy·ªÖn Tr·∫ßn Linh Ng√¢n", "V≈© B·∫£o Ng√¢n", 
                "Nguy·ªÖn Ph√∫c Kh√¥i Nguy√™n", "ƒê·ªó Kh·∫Øc Minh Nh·∫≠t", "L√™ Ng·ªçc An Nhi√™n", "Tr·∫ßn Quang Ninh", 
                "Nguy·ªÖn H√† Minh Ph√°t", "ƒê·ªó Ho√†ng Qu√¢n", "Nguy·ªÖn Th·ªã Minh T√¢m", "Tr·∫ßn Ph·∫°m Qu·ªëc Th·∫Øng", 
                "Phan Ti·∫øn Th·ªãnh", "T√¥ Vƒ©nh Th·ª•y", "Tr·∫ßn L√™ Gia Tu·ªá", "Tr·∫ßn H·ªØu Vi·ªát", "Ph√≠ Ng·ªçc Kh√°nh Vy"
            ]);
            
            const [appState, setAppState] = useState("INIT"); // INIT, LOADING, READY
            const [isSpinning, setIsSpinning] = useState(false);
            const [winners, setWinners] = useState([]);
            const [isEditing, setIsEditing] = useState(false);
            const [tempList, setTempList] = useState("");
            
            // Hand Tracking Logic
            const [cursorPos, setCursorPos] = useState({ x: -500, y: -500 });
            const [isHandDetected, setIsHandDetected] = useState(false);
            const [hoverTarget, setHoverTarget] = useState(null); 
            const [hoverProgress, setHoverProgress] = useState(0); 

            // Refs
            const videoRef = useRef(null);
            const containerRef = useRef(null);
            const btnRefs = useRef({}); 
            const logic = useRef({
                scene: null, camera: null, renderer: null, particles: [], nameGroup: null,
                isMounted: true, isProcessing: false, hoverStartTime: 0
            });

            // 1. KH·ªûI T·∫†O 3D SCENE
            useEffect(() => {
                logic.current.isMounted = true;
                if(!containerRef.current) return;
                
                const w = window.innerWidth, h = window.innerHeight;
                const scene = new THREE.Scene();
                // S∆∞∆°ng m√π h∆∞ ·∫£o
                scene.fog = new THREE.FogExp2(0x1a0b2e, 0.05);

                const camera = new THREE.PerspectiveCamera(75, w/h, 0.1, 100);
                camera.position.z = 7; 
                
                const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
                renderer.setSize(w, h);
                containerRef.current.appendChild(renderer.domElement);
                
                // T·∫°o c√°c ƒë·ªëm linh kh√≠
                const particles = [];
                for(let i=0; i<60; i++) particles.push(new SpiritParticle(scene));

                logic.current.scene = scene; logic.current.camera = camera;
                logic.current.renderer = renderer; logic.current.particles = particles;

                const animate = () => {
                    if(!logic.current.isMounted) return;
                    requestAnimationFrame(animate);
                    
                    particles.forEach(p => p.update());
                    
                    // Xoay v√≤ng tr√≤n t√™n
                    if(logic.current.nameGroup) {
                        logic.current.nameGroup.rotation.y += isSpinning ? 0.2 : 0.005;
                        logic.current.nameGroup.rotation.z = Math.sin(Date.now()*0.0005)*0.1; // L·∫Øc l∆∞ nh·∫π
                    }
                    
                    renderer.render(scene, camera);
                };
                animate();
                updateNameRing(scene, studentList);

                return () => { logic.current.isMounted = false; }
            }, []);

            // C·∫≠p nh·∫≠t v√≤ng tr√≤n t√™n khi danh s√°ch ƒë·ªïi
            const updateNameRing = (scene, list) => {
                if(logic.current.nameGroup) scene.remove(logic.current.nameGroup);
                const group = new THREE.Group();
                list.forEach((name, i) => {
                    const sprite = createNameSprite(name);
                    const angle = (i / list.length) * Math.PI * 2;
                    const r = 10; // B√°n k√≠nh v√≤ng xoay
                    // X·∫øp theo h√¨nh tr√¥n ·ªëc ho·∫∑c tr·ª• tr√≤n
                    sprite.position.set(Math.cos(angle)*r, (Math.random()-0.5)*4, Math.sin(angle)*r);
                    group.add(sprite);
                });
                scene.add(group);
                logic.current.nameGroup = group;
            };

            useEffect(() => { 
                if(logic.current.scene) updateNameRing(logic.current.scene, studentList); 
            }, [studentList]);

            // 2. CAMERA & MEDIA PIPE SETUP
            const startCamera = async () => {
                try {
                    setAppState("LOADING");
                    const stream = await navigator.mediaDevices.getUserMedia({video: {facingMode: "environment"}});
                    if(videoRef.current) { 
                        videoRef.current.srcObject = stream; 
                        await videoRef.current.play(); 
                    }

                    const hands = new window.Hands({locateFile: (f) => `https://unpkg.com/@mediapipe/hands@0.4.1675469240/${f}`});
                    hands.setOptions({maxNumHands: 1, minDetectionConfidence: 0.6, minTrackingConfidence: 0.5});
                    hands.onResults(onHandResults);

                    const process = async () => {
                        if (!logic.current.isMounted) return;
                        if(videoRef.current && videoRef.current.readyState >= 2 && !logic.current.isProcessing) {
                            logic.current.isProcessing = true;
                            await hands.send({image: videoRef.current});
                            logic.current.isProcessing = false;
                        }
                        requestAnimationFrame(process);
                    };
                    process();
                    setAppState("READY");
                } catch(e) { console.error(e); alert("L·ªói Camera: " + e.message); setAppState("INIT"); }
            };

            // 3. X·ª¨ L√ù NG√ìN TAY V√Ä T∆Ø∆†NG T√ÅC
            const onHandResults = (results) => {
                if (!results.multiHandLandmarks || results.multiHandLandmarks.length === 0) {
                    setIsHandDetected(false);
                    return;
                }
                setIsHandDetected(true);

                // D√πng ƒë·∫ßu ng√≥n tr·ªè (Landmark 8) l√†m con tr·ªè ph√°p thu·∫≠t
                const lm = results.multiHandLandmarks[0];
                const indexTip = lm[8];
                
                // Mirror coordinates (do camera b·ªã l·∫≠t)
                const x = (1 - indexTip.x) * window.innerWidth;
                const y = indexTip.y * window.innerHeight;
                setCursorPos({x, y});

                // Check va ch·∫°m n·∫øu kh√¥ng ƒëang quay th∆∞·ªüng
                if (appState === "READY" && !isSpinning && winners.length === 0) {
                    checkCollision(x, y);
                }
            };

            const checkCollision = (cx, cy) => {
                let hitId = null;
                const hitZone = 40; // Pixel tolerance

                [1, 2, 3, 4, 5].forEach(num => {
                    const btn = btnRefs.current[num];
                    if (btn) {
                        const rect = btn.getBoundingClientRect();
                        // M·ªü r·ªông v√πng va ch·∫°m m·ªôt ch√∫t ƒë·ªÉ d·ªÖ ch·ªçn
                        if (cx >= rect.left - hitZone && cx <= rect.right + hitZone && 
                            cy >= rect.top - hitZone && cy <= rect.bottom + hitZone) {
                            hitId = num;
                        }
                    }
                });

                const now = Date.now();
                if (hitId) {
                    if (hitId !== hoverTarget) {
                        setHoverTarget(hitId);
                        logic.current.hoverStartTime = now;
                        setHoverProgress(0);
                        playSound('hover');
                    } else {
                        // Logic gi·ªØ 1.5 gi√¢y ƒë·ªÉ ch·ªçn
                        const elapsed = now - logic.current.hoverStartTime;
                        const prog = Math.min((elapsed / 1500) * 100, 100); 
                        setHoverProgress(prog);
                        
                        if (prog >= 100 && !isSpinning) {
                            triggerGift(hitId);
                            setHoverTarget(null);
                        }
                    }
                } else {
                    if (hoverTarget !== null) {
                        setHoverTarget(null);
                        setHoverProgress(0);
                    }
                }
            };

            // 4. QUAY TH∆Ø·ªûNG (V·∫¨N KH√ç)
            const triggerGift = (count) => {
                if(studentList.length < count) { alert("Kh√¥ng ƒë·ªß ƒë·∫°o h·ªØu ƒë·ªÉ ch·ªçn!"); return; }
                
                playSound('select');
                setIsSpinning(true);
                
                // Th·ªùi gian quay ng·∫´u nhi√™n t·ª´ 2.5s - 3.5s
                setTimeout(() => {
                    const pool = [...studentList];
                    const selected = [];
                    for(let i=0; i<count; i++) {
                        const idx = Math.floor(Math.random() * pool.length);
                        selected.push(pool[idx]); pool.splice(idx, 1);
                    }
                    setWinners(selected);
                    setIsSpinning(false);
                    playSound('win');
                    // Hi·ªáu ·ª©ng n·ªï linh kh√≠ (optional logic extension here)
                }, 3000);
            };

            const confirmResult = (remove) => {
                if(remove) setStudentList(studentList.filter(s => !winners.includes(s)));
                setWinners([]);
            };

            return (
                <div className="w-full h-full relative select-none text-yellow-500 overflow-hidden">
                    <video ref={videoRef} playsInline muted id="input-video"></video>
                    <div ref={containerRef} className="absolute inset-0 z-0"></div>

                    {/* SPIRIT CURSOR - Ch·ªâ hi·ªán khi th·∫•y tay */}
                    <div className="spirit-cursor" style={{ 
                        transform: `translate(${cursorPos.x}px, ${cursorPos.y}px)`,
                        opacity: isHandDetected ? 1 : 0
                    }}></div>

                    {/* UI TR√äN C√ôNG */}
                    <div className="absolute top-0 w-full p-4 flex justify-between items-start z-50 pointer-events-none">
                        <div className="glass-panel px-6 py-3 pointer-events-auto">
                            <h1 className="text-3xl title-font text-yellow-400">Thi√™n C∆° B·∫£ng</h1>
                            <p className="text-sm text-cyan-300">Nh√¢n s·ªë: {studentList.length} ƒê·∫°o H·ªØu</p>
                        </div>
                        <button onClick={()=>{setIsEditing(true); setTempList(studentList.join('\n'))}} 
                            className="glass-panel w-12 h-12 flex items-center justify-center pointer-events-auto hover:bg-white/10 text-xl text-yellow-400">
                            <i className="fas fa-scroll"></i>
                        </button>
                    </div>

                    {/* UI CH√çNH */}
                    <div className="absolute inset-0 z-40 flex flex-col items-center justify-center pointer-events-none">
                        
                        {/* H∆∞·ªõng d·∫´n t√¨m tay */}
                        {appState === "READY" && !isHandDetected && !isSpinning && winners.length === 0 && (
                            <div className="absolute top-24 bg-black/60 px-6 py-2 rounded-full border border-cyan-500 animate-pulse">
                                <span className="text-cyan-300 font-bold text-lg"><i className="fas fa-hand-sparkles mr-2"></i>Gi∆° tay l√™n ƒë·ªÉ ƒë·ªãnh v·ªã Linh L·ª±c</span>
                            </div>
                        )}

                        {/* M√ÄN H√åNH CH·ªåN S·ªê (TR·∫¨N PH√ÅP) */}
                        {appState === "READY" && !isSpinning && winners.length === 0 && (
                            <div className="flex flex-col items-center animate__animated animate__fadeIn">
                                <div className="mb-16 text-center">
                                    <h2 className="text-4xl title-font mb-4 drop-shadow-[0_0_10px_rgba(255,215,0,0.8)]">Ch·ªçn S·ªë L∆∞·ª£ng Ph√°p B·∫£o</h2>
                                    <p className="text-cyan-200 bg-black/50 px-4 py-1 rounded-lg border border-cyan-800">
                                        D√πng <span className="text-yellow-400 font-bold">Ng√≥n Tr·ªè</span> tr·ªè v√†o tr·∫≠n ph√°p ƒë·ªÉ k√≠ch ho·∫°t
                                    </p>
                                </div>

                                <div className="flex gap-6 md:gap-10 pointer-events-auto">
                                    {[1, 2, 3, 4, 5].map(num => (
                                        <div 
                                            key={num}
                                            ref={el => btnRefs.current[num] = el}
                                            className={`dharma-btn w-20 h-20 md:w-28 md:h-28 flex items-center justify-center cursor-pointer
                                                ${hoverTarget === num ? 'hovered' : ''}`}
                                        >
                                            <div className="btn-content z-10 text-4xl md:text-6xl font-bold font-serif">{num}</div>
                                            {/* Energy Fill */}
                                            <div className="energy-fill" style={{ height: hoverTarget === num ? `${hoverProgress}%` : '0%' }}></div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* HI·ªÜU ·ª®NG QUAY (V·∫¨N C√îNG) */}
                        {isSpinning && (
                            <div className="text-center z-50">
                                <div className="text-8xl animate-spin mb-6 opacity-80" style={{animationDuration: '3s'}}>‚òØÔ∏è</div>
                                <div className="text-5xl font-bold text-yellow-300 title-font animate-pulse">ƒêang V·∫≠n Kh√≠...</div>
                            </div>
                        )}

                        {/* K·∫æT QU·∫¢ (TI√äN DUY√äN) */}
                        {winners.length > 0 && (
                            <div className="w-full max-w-5xl px-4 flex flex-col items-center pointer-events-auto animate__animated animate__zoomIn">
                                <h2 className="text-5xl title-font mb-8 text-yellow-300 drop-shadow-[0_0_15px_#ff0000]">üéâ Ch√∫c M·ª´ng ƒê·∫°o H·ªØu üéâ</h2>
                                <div className="flex flex-wrap justify-center gap-8 mb-10">
                                    {winners.map((w, i) => (
                                        <div key={i} className="gift-card px-8 py-6 rounded-lg flex flex-col items-center min-w-[220px]">
                                            <div className="text-5xl mb-3 drop-shadow-[0_0_10px_gold]">üíé</div>
                                            <div className="text-2xl font-bold text-cyan-300 text-center font-serif">{w}</div>
                                        </div>
                                    ))}
                                </div>
                                <div className="flex gap-6">
                                    <button onClick={()=>confirmResult(false)} className="px-8 py-3 rounded border border-gray-500 text-gray-300 hover:bg-gray-800 font-serif font-bold uppercase tracking-wider">L∆∞u Danh</button>
                                    <button onClick={()=>confirmResult(true)} className="px-10 py-3 rounded bg-gradient-to-r from-red-800 to-red-600 text-white font-serif font-bold uppercase tracking-wider border border-red-400 shadow-[0_0_20px_red] hover:scale-105 transition-transform">X√≥a & Ti·∫øp T·ª•c</button>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* M√ÄN H√åNH B·∫ÆT ƒê·∫¶U */}
                    {appState === "INIT" && (
                        <div className="absolute inset-0 z-50 flex items-center justify-center p-4 bg-black/90">
                            <div className="glass-panel max-w-lg w-full p-12 text-center border-2 border-yellow-600">
                                <div className="text-6xl mb-6">üîÆ</div>
                                <h1 className="text-5xl title-font mb-4 text-yellow-500">Thi√™n C∆° B·∫£ng</h1>
                                <p className="mb-10 text-cyan-200 text-lg font-serif">"V·∫°n s·ª± t√πy duy√™n, v·∫≠n kh√≠ do tr·ªùi"</p>
                                <button onClick={startCamera} className="w-full py-5 rounded bg-gradient-to-r from-yellow-700 to-yellow-500 text-black font-bold text-2xl shadow-[0_0_20px_gold] hover:scale-105 transition-transform font-serif">
                                    KHAI M·ªû B√ç C·∫¢NH
                                </button>
                            </div>
                        </div>
                    )}
                    
                    {/* EDIT MODAL */}
                    {isEditing && (
                        <div className="absolute inset-0 z-50 flex items-center justify-center p-4 bg-black/90 backdrop-blur-md">
                            <div className="glass-panel w-full max-w-2xl p-6 h-[80vh] flex flex-col bg-[#1a0b2e]">
                                <h3 className="text-3xl font-bold text-yellow-500 mb-4 text-center title-font">Danh S√°ch ƒê·∫°o H·ªØu</h3>
                                <textarea className="flex-1 bg-black/50 border border-yellow-700 rounded p-4 text-cyan-300 font-serif text-lg resize-none focus:outline-none focus:border-yellow-400"
                                    value={tempList} onChange={(e) => setTempList(e.target.value)}></textarea>
                                <div className="flex justify-end gap-4 mt-6">
                                    <button onClick={() => setIsEditing(false)} className="px-6 py-2 text-gray-400 font-bold hover:text-white">H·ªßy B·ªè</button>
                                    <button onClick={() => { setStudentList(tempList.split('\n').filter(l => l.trim())); setIsEditing(false); }} className="px-8 py-2 bg-yellow-700 text-black font-bold rounded hover:bg-yellow-500 shadow-[0_0_10px_gold]">L∆∞u L·∫°i</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>