<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªçc Li·ªáu S·ªë: H√¨nh LƒÉng Tr·ª• ƒê·ª©ng - L·ªãch ƒê·ªÉ B√†n 2026</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #f0f0f0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        #canvas-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }

        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            text-align: left;
            color: #333;
            pointer-events: none;
            z-index: 10;
            background: rgba(255,255,255,0.8);
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            max-width: 300px;
        }
        #info h2 { margin: 0 0 5px 0; font-size: 18px; color: #B22222; }
        #info p { margin: 0; font-size: 13px; color: #555; }

        #learning-panel {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 340px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 20;
            max-height: 90vh;
            overflow-y: auto;
        }

        .panel-header { font-size: 18px; font-weight: bold; color: #2E8B57; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 15px; }
        
        .question-box { background: #fff9f9; padding: 15px; border-radius: 8px; border-left: 5px solid #B22222; margin-bottom: 15px; box-shadow: inset 0 0 5px rgba(0,0,0,0.05); }
        .question-title { font-weight: bold; color: #B22222; display: block; margin-bottom: 5px; text-transform: uppercase; font-size: 13px; }
        .question-text { font-size: 15px; line-height: 1.5; color: #333; display: block; margin-bottom: 10px; }
        .dynamic-value { color: #B22222; font-weight: bold; border-bottom: 1px dashed #B22222; }

        .input-group { display: flex; gap: 5px; margin-bottom: 10px; }
        input[type="number"] { flex: 1; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 16px; outline: none; transition: border-color 0.3s; }
        input[type="number"]:focus { border-color: #2E8B57; }
        
        button { cursor: pointer; border: none; padding: 10px 15px; border-radius: 6px; font-weight: bold; transition: all 0.2s; margin-bottom: 8px; width: 100%; font-size: 14px; }
        #checkBtn { background-color: #2E8B57; color: white; width: auto; margin-bottom: 0; padding: 10px 20px; }
        #checkBtn:hover { background-color: #257045; transform: scale(1.02); }
        
        #guideBtn { background-color: #FF8C00; color: white; }
        #newExerciseBtn { background-color: #4682B4; color: white; margin-top: 5px; }
        
        #customForm { display: none; background: #f0f4f8; padding: 12px; border-radius: 8px; margin-top: 10px; border: 1px solid #d1d9e6; }
        #customForm label { font-size: 12px; color: #555; font-weight: bold; display: block; margin-top: 5px; }
        #customForm input { width: 100%; margin: 2px 0 8px 0; padding: 8px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; }
        
        .feedback { margin-top: 12px; font-weight: bold; min-height: 24px; font-size: 14px; padding: 10px; border-radius: 4px; display: none; }
        .correct { color: #155724; background-color: #d4edda; border: 1px solid #c3e6cb; display: block !important; }
        .incorrect { color: #721c24; background-color: #f8d7da; border: 1px solid #f5c6cb; display: block !important; }

        #guideContent { margin-top: 15px; border-top: 1px dashed #ccc; padding-top: 10px; display: none; }
        #guideContent.show { display: block; animation: fadeIn 0.4s; }
        .math { font-family: "Times New Roman", Times, serif; font-style: italic; background: #eee; padding: 2px 6px; border-radius: 4px; font-weight: bold; color: #00008B; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>
    <div id="info">
        <h2>L·ªãch T·∫øt 2026 - H√¨nh LƒÉng Tr·ª•</h2>
        <p>üñ±Ô∏è <strong>Xoay:</strong> Chu·ªôt tr√°i | üîç <strong>Zoom:</strong> Cu·ªôn chu·ªôt</p>
    </div>

    <div id="learning-panel">
        <div class="panel-header">üéì G√≥c H·ªçc T·∫≠p</div>
        
        <div class="question-box">
            <span class="question-title">üìù ƒê·ªÅ b√†i to√°n h·ªçc:</span>
            <span class="question-text" id="questionContent">
                Cho chi·∫øc l·ªãch ƒë·ªÉ b√†n c√≥ h√¨nh lƒÉng tr·ª• ƒë·ª©ng tam gi√°c v·ªõi c√°c k√≠ch th∆∞·ªõc: 
                c·∫°nh b√™n ƒë√°y <span class="dynamic-value" id="valSlant">15</span> cm, 
                c·∫°nh ƒë√°y <span class="dynamic-value" id="valBase">7</span> cm v√† 
                chi·ªÅu d√†i l·ªãch <span class="dynamic-value" id="valLength">16</span> cm.
                <br><br>
                H√£y t√≠nh <b>di·ªán t√≠ch xung quanh</b> c·ªßa chi·∫øc l·ªãch (cm¬≤).
                <br><i>(L√†m tr√≤n k·∫øt qu·∫£ ƒë·∫øn h√†ng ƒë∆°n v·ªã)</i>
            </span>
            
            <div class="input-group">
                <input type="number" id="userAnswer" placeholder="K·∫øt qu·∫£ c·ªßa em...">
                <button id="checkBtn">Ki·ªÉm tra</button>
            </div>
            <div id="feedback" class="feedback"></div>
        </div>

        <button id="guideBtn">üí° Xem g·ª£i √Ω gi·∫£i b√†i</button>
        <div id="guideContent"></div>
        
        <button id="newExerciseBtn">‚ûï ƒêi·ªÅu ch·ªânh k√≠ch th∆∞·ªõc (Th·ª≠ th√°ch)</button>
        <div id="customForm">
            <label>C·∫°nh b√™n tam gi√°c ƒë√°y (cm):</label>
            <input type="number" id="inputSlant" value="15" step="1" min="1">
            <label>C·∫°nh ƒë√°y tam gi√°c (cm):</label>
            <input type="number" id="inputBase" value="7" step="1" min="1">
            <label>Chi·ªÅu d√†i kh·ªëi l·ªãch (cm):</label>
            <input type="number" id="inputLength" value="16" step="1" min="1">
            <p style="font-size: 11px; color: #666; margin: 0;">* C√°c thay ƒë·ªïi s·∫Ω c·∫≠p nh·∫≠t ngay l·∫≠p t·ª©c l√™n m√¥ h√¨nh v√† ƒë·ªÅ b√†i.</p>
        </div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.module.min.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // Bi·∫øn to√†n c·ª•c
        let slantHeight = 15; 
        let width = 16;       
        let baseDepth = 7;    
        let correctAnswer = 0;

        let scene, camera, renderer, controls, calendarGroup, dimensionGroup;
        
        // V·∫≠t li·ªáu
        const coverMaterial = new THREE.MeshStandardMaterial({ color: 0xB22222, roughness: 0.6, side: THREE.DoubleSide });
        const whiteMaterial = new THREE.MeshStandardMaterial({ color: 0xffffff, roughness: 0.5 });
        const ringMaterial = new THREE.MeshStandardMaterial({ color: 0x333333, metalness: 0.8, roughness: 0.2 });

        init();
        animate();

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xf0f0f0);
            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(25, 20, 30);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.body.appendChild(renderer.domElement);

            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;

            // √Ånh s√°ng
            scene.add(new THREE.AmbientLight(0xffffff, 0.7));
            const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
            dirLight.position.set(15, 25, 15);
            dirLight.castShadow = true;
            scene.add(dirLight);

            // N·ªÅn 3D
            scene.add(new THREE.GridHelper(100, 50, 0xcccccc, 0xe5e5e5));
            const plane = new THREE.Mesh(new THREE.PlaneGeometry(200, 200), new THREE.ShadowMaterial({ opacity: 0.1 }));
            plane.rotation.x = -Math.PI / 2;
            plane.receiveShadow = true;
            scene.add(plane);

            rebuildModel();
            updateMathLogic();

            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }

        // T·∫°o nh√£n k√≠ch th∆∞·ªõc ƒë·ªông
        function createDimensionLabel(text, startPoint, endPoint, offsetDir) {
            const group = new THREE.Group();
            const arrowColor = 0xcc0000;
            const p1 = startPoint.clone().add(offsetDir);
            const p2 = endPoint.clone().add(offsetDir);

            const line = new THREE.Line(new THREE.BufferGeometry().setFromPoints([p1, p2]), new THREE.LineBasicMaterial({ color: arrowColor }));
            group.add(line);

            const coneGeo = new THREE.ConeGeometry(0.2, 0.6, 8);
            const coneMat = new THREE.MeshBasicMaterial({ color: arrowColor });
            const c1 = new THREE.Mesh(coneGeo, coneMat); c1.position.copy(p1); c1.lookAt(p2); c1.rotateX(-Math.PI/2); group.add(c1);
            const c2 = new THREE.Mesh(coneGeo, coneMat); c2.position.copy(p2); c2.lookAt(p1); c2.rotateX(-Math.PI/2); group.add(c2);

            const canvas = document.createElement('canvas');
            canvas.width = 450; canvas.height = 120;
            const ctx = canvas.getContext('2d');
            ctx.font = "Bold 36px Arial"; ctx.fillStyle = "black"; ctx.textAlign = "center"; ctx.textBaseline = "middle";
            ctx.fillText(text, 225, 60);
            const sprite = new THREE.Sprite(new THREE.SpriteMaterial({ map: new THREE.CanvasTexture(canvas), transparent: true }));
            sprite.position.copy(new THREE.Vector3().addVectors(p1, p2).multiplyScalar(0.5)).add(offsetDir.clone().normalize().multiplyScalar(1.2));
            sprite.scale.set(11, 3, 1);
            group.add(sprite);
            dimensionGroup.add(group);
        }

        function rebuildModel() {
            if (calendarGroup) scene.remove(calendarGroup);
            if (dimensionGroup) scene.remove(dimensionGroup);
            calendarGroup = new THREE.Group();
            dimensionGroup = new THREE.Group();
            scene.add(calendarGroup);
            scene.add(dimensionGroup);

            const halfBase = baseDepth / 2;
            const verticalHeight = Math.sqrt(Math.max(0, Math.pow(slantHeight, 2) - Math.pow(halfBase, 2)));
            const tiltAngle = Math.asin(Math.min(1, halfBase / slantHeight));
            const thickness = 0.2;

            const coverGeo = new THREE.BoxGeometry(width, slantHeight, thickness);
            const front = new THREE.Mesh(coverGeo, coverMaterial);
            front.position.set(0, verticalHeight / 2, halfBase / 2); front.rotation.x = -tiltAngle; front.castShadow = true;
            calendarGroup.add(front);

            const back = new THREE.Mesh(coverGeo, coverMaterial);
            back.position.set(0, verticalHeight / 2, -halfBase / 2); back.rotation.x = tiltAngle; back.castShadow = true;
            calendarGroup.add(back);

            const bottom = new THREE.Mesh(new THREE.BoxGeometry(width, baseDepth, thickness), coverMaterial);
            bottom.rotation.x = Math.PI / 2; bottom.position.y = 0.05; bottom.receiveShadow = true;
            calendarGroup.add(bottom);

            // C√°c trang l·ªãch
            function addPages(isFront) {
                const texture = createCalendarTexture(isFront ? 0 : 1);
                const mats = [whiteMaterial, whiteMaterial, whiteMaterial, whiteMaterial, new THREE.MeshBasicMaterial({ map: texture }), whiteMaterial];
                const page = new THREE.Mesh(new THREE.BoxGeometry(width - 0.8, slantHeight - 0.8, 0.05), mats);
                if (isFront) { page.position.set(0, verticalHeight/2, halfBase/2 + 0.15); page.rotation.x = -tiltAngle; }
                else { page.position.set(0, verticalHeight/2, -halfBase/2 - 0.15); page.rotation.x = tiltAngle; page.rotation.y = Math.PI; }
                page.castShadow = true; calendarGroup.add(page);
            }
            addPages(true); addPages(false);

            // L√≤ xo
            const ringCount = 12;
            for (let i = 0; i < ringCount; i++) {
                const ring = new THREE.Mesh(new THREE.TorusGeometry(0.5, 0.06, 8, 16), ringMaterial);
                ring.position.set(-width/2 + 1 + (i * (width-2)/(ringCount-1)), verticalHeight, 0);
                ring.rotation.y = Math.PI / 2; ring.castShadow = true; calendarGroup.add(ring);
            }

            // Nh√£n s·ªë li·ªáu (ƒê√£ ƒë∆∞·ª£c n√¢ng ƒë·ªô cao hi·ªÉn th·ªã Y ƒë·ªÉ kh√¥ng b·ªã ch√¨m)
            createDimensionLabel(`C·∫°nh b√™n: ${slantHeight} cm`, 
                new THREE.Vector3(-width/2, verticalHeight, 0), 
                new THREE.Vector3(-width/2, 0, halfBase), 
                new THREE.Vector3(-3, 0, 1));
            
            createDimensionLabel(`Chi·ªÅu d√†i l·ªãch: ${width} cm`, 
                new THREE.Vector3(-width/2, 0.8, halfBase), // TƒÉng Y t·ª´ 0.1 l√™n 0.8
                new THREE.Vector3(width/2, 0.8, halfBase),  // TƒÉng Y t·ª´ 0.1 l√™n 0.8
                new THREE.Vector3(0, 0, 3));

            createDimensionLabel(`C·∫°nh ƒë√°y: ${baseDepth} cm`, 
                new THREE.Vector3(width/2 + 0.5, 0.8, halfBase), // TƒÉng Y t·ª´ 0.1 l√™n 0.8
                new THREE.Vector3(width/2 + 0.5, 0.8, -halfBase),// TƒÉng Y t·ª´ 0.1 l√™n 0.8
                new THREE.Vector3(3, 0, 0));
        }

        // V·∫Ω trang tr√≠ T·∫øt (Mai & ƒê√†o)
        function drawDecoration(ctx, type) {
            ctx.save();
            ctx.strokeStyle = '#5D4037'; ctx.lineWidth = 6; ctx.lineCap = 'round';
            ctx.beginPath(); ctx.moveTo(480, 220); ctx.bezierCurveTo(400, 150, 450, 100, 320, 50); ctx.stroke();
            const flowerColor = (type === 'mai') ? '#FFD700' : '#FF69B4';
            const centerColor = (type === 'mai') ? '#FF8C00' : '#D00060';
            const points = [[450, 180], [380, 120], [320, 50], [380, 25], [410, 140], [460, 100]];
            points.forEach(p => {
                ctx.fillStyle = flowerColor;
                for (let i = 0; i < 5; i++) {
                    ctx.beginPath(); const angle = (i * 2 * Math.PI) / 5;
                    ctx.ellipse(p[0] + Math.cos(angle) * 8, p[1] + Math.sin(angle) * 8, 8, 5, angle, 0, Math.PI * 2); ctx.fill();
                }
                ctx.fillStyle = centerColor; ctx.beginPath(); ctx.arc(p[0], p[1], 4, 0, Math.PI * 2); ctx.fill();
            });
            ctx.restore();
        }

        function createCalendarTexture(monthIndex) {
            const canvas = document.createElement('canvas'); canvas.width = 512; canvas.height = 512;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#ffffff'; ctx.fillRect(0, 0, 512, 512);
            ctx.fillStyle = monthIndex === 0 ? '#B22222' : '#2E8B57'; ctx.fillRect(0, 0, 512, 120);
            if (monthIndex === 0) {
                drawDecoration(ctx, 'mai');
                ctx.fillStyle = '#FFD700'; ctx.font = 'italic bold 22px Arial'; ctx.textAlign = 'right'; ctx.fillText("Ch√∫c M·ª´ng NƒÉm M·ªõi", 500, 110);
            } else {
                drawDecoration(ctx, 'dao');
                ctx.fillStyle = '#FFC0CB'; ctx.font = 'italic bold 22px Arial'; ctx.textAlign = 'right'; ctx.fillText("V·∫°n S·ª± Nh∆∞ √ù", 500, 110);
            }
            ctx.fillStyle = '#ffffff'; ctx.font = 'bold 50px Arial'; ctx.textAlign = 'center'; ctx.fillText(`TH√ÅNG 0${monthIndex + 1} / 2026`, 256, 75);
            const daysHeader = ['CN', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7'];
            ctx.font = 'bold 22px Arial';
            daysHeader.forEach((d, i) => { ctx.fillStyle = i === 0 ? '#d00' : '#333'; ctx.fillText(d, 60 + i * 65, 170); });
            let firstDayIndex = monthIndex === 0 ? 4 : 0;
            let date = 1; ctx.font = 'bold 28px Arial';
            for (let row = 0; row < 6; row++) {
                for (let col = 0; col < 7; col++) {
                    const idx = row * 7 + col;
                    if (idx >= firstDayIndex && date <= (monthIndex === 0 ? 31 : 28)) {
                        const x = 60 + col * 65; const y = 230 + row * 50;
                        if (monthIndex === 0 && date === 25) {
                            ctx.strokeStyle = 'red'; ctx.lineWidth = 4; ctx.beginPath(); ctx.arc(x, y - 10, 25, 0, Math.PI * 2); ctx.stroke();
                            ctx.fillStyle = 'red'; ctx.font = 'bold 14px Arial'; ctx.fillText("Seminar", x, y + 30);
                        }
                        ctx.fillStyle = col === 0 ? '#d00' : '#333'; ctx.textAlign = 'center'; ctx.fillText(date.toString(), x, y); date++;
                    }
                }
            }
            const tex = new THREE.CanvasTexture(canvas); tex.colorSpace = THREE.SRGBColorSpace; return tex;
        }

        function updateMathLogic() {
            // C·∫≠p nh·∫≠t gi√° tr·ªã hi·ªÉn th·ªã tr√™n ƒë·ªÅ b√†i
            document.getElementById('valSlant').textContent = slantHeight;
            document.getElementById('valBase').textContent = baseDepth;
            document.getElementById('valLength').textContent = width;

            const perimeter = (slantHeight * 2) + baseDepth;
            const exactResult = perimeter * width;
            correctAnswer = Math.round(exactResult);

            const guideHTML = `
                <div style="font-size:14px; line-height:1.6;">
                    <b>üí° G·ª£i √Ω gi·∫£i:</b><br>
                    - Chu vi tam gi√°c ƒë√°y: <br><span class="math">P = ${slantHeight} + ${slantHeight} + ${baseDepth} = ${perimeter} (cm)</span><br>
                    - Di·ªán t√≠ch xung quanh: <br><span class="math">S_xq = P √ó h = ${perimeter} √ó ${width} = ${exactResult} (cm¬≤)</span><br>
                    - K·∫øt qu·∫£ l√†m tr√≤n: <b>${correctAnswer} cm¬≤</b>
                </div>`;
            document.getElementById('guideContent').innerHTML = guideHTML;
        }

        // --- X·ª¨ L√ù S·ª∞ KI·ªÜN LIVE UPDATE ---
        const inputs = ['inputSlant', 'inputBase', 'inputLength'];
        inputs.forEach(id => {
            document.getElementById(id).addEventListener('input', (e) => {
                const val = parseFloat(e.target.value);
                if (val > 0) {
                    if (id === 'inputSlant') slantHeight = val;
                    if (id === 'inputBase') baseDepth = val;
                    if (id === 'inputLength') width = val;
                    
                    rebuildModel();
                    updateMathLogic();
                    
                    document.getElementById('feedback').style.display = 'none';
                    document.getElementById('userAnswer').value = '';
                }
            });
        });

        document.getElementById('checkBtn').onclick = () => {
            const userVal = parseFloat(document.getElementById('userAnswer').value);
            const fb = document.getElementById('feedback');
            fb.style.display = 'block';
            if (isNaN(userVal)) {
                fb.innerHTML = "‚ö†Ô∏è Em h√£y nh·∫≠p con s·ªë ƒë√°p √°n nh√©!"; fb.className = "feedback incorrect";
            } else if (Math.abs(userVal - correctAnswer) < 0.1) {
                fb.innerHTML = `üéâ Tuy·ªát v·ªùi! ${correctAnswer} cm¬≤ l√† ƒë√°p √°n ch√≠nh x√°c.`; fb.className = "feedback correct";
            } else {
                fb.innerHTML = "‚ùå Ch∆∞a ƒë√∫ng r·ªìi. Em h√£y ki·ªÉm tra l·∫°i c√°c s·ªë ƒëo tr√™n h√¨nh v√† ƒë·ªÅ b√†i nh√©!"; fb.className = "feedback incorrect";
            }
        };

        document.getElementById('guideBtn').onclick = () => {
            const g = document.getElementById('guideContent');
            g.classList.toggle('show');
            document.getElementById('guideBtn').textContent = g.classList.contains('show') ? "·∫®n g·ª£i √Ω" : "üí° Xem g·ª£i √Ω gi·∫£i b√†i";
        };

        document.getElementById('newExerciseBtn').onclick = () => {
            const f = document.getElementById('customForm');
            f.style.display = f.style.display === 'block' ? 'none' : 'block';
        };

        function animate() { requestAnimationFrame(animate); controls.update(); renderer.render(scene, camera); }
    </script>
</body>
</html>