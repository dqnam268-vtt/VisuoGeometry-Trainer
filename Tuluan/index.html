<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luy·ªán T·∫≠p T·ª± Lu·∫≠n: H√¨nh LƒÉng Tr·ª• ƒê·ª©ng</title>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #2ecc71;
            --warning: #f1c40f;
            --danger: #e74c3c;
            --light: #f8f9fa;
            --dark: #212529;
            --border-radius: 12px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #eef2f5;
            color: var(--dark);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* HEADER */
        header {
            background: var(--primary);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 { margin: 0; font-size: 22px; }
        
        .progress-container {
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            padding: 5px 15px;
            font-size: 14px;
            font-weight: bold;
        }

        /* BODY */
        .main-content {
            padding: 30px;
            flex: 1;
        }

        .question-box {
            background: #fdfdfd;
            border: 1px solid #e0e0e0;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
        }

        .q-title {
            font-size: 18px;
            font-weight: bold;
            color: var(--secondary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .q-content {
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        /* INPUT AREA */
        .answer-area {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        label { font-weight: 600; font-size: 14px; color: #555; }

        textarea {
            width: 100%;
            height: 150px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            font-family: inherit;
            font-size: 15px;
            resize: vertical;
            transition: border-color 0.3s;
            box-sizing: border-box;
        }

        textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* FILL IN BLANK STYLES */
        .fill-in-box {
            background: #f0f4f8;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--secondary);
        }
        
        .fill-line {
            margin-bottom: 10px;
            font-size: 16px;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
        }

        .calc-input {
            width: 80px;
            padding: 5px 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            text-align: center;
            font-weight: bold;
            color: var(--primary);
        }

        .calc-input:focus {
            outline: none;
            border-color: var(--primary);
            background: #fff;
        }

        .unit {
            font-weight: bold;
            color: #555;
        }

        /* CONTROLS */
        .controls {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 20px;
        }

        button {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            font-size: 15px;
            transition: all 0.2s;
        }

        .btn-submit { background: var(--success); color: white; }
        .btn-submit:hover { background: #27ae60; transform: translateY(-2px); }

        .btn-next { background: var(--primary); color: white; display: none; }
        .btn-next:hover { background: var(--secondary); }

        .btn-export { background: var(--warning); color: #333; }

        /* FEEDBACK SECTION */
        .feedback-section {
            margin-top: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-left: 5px solid var(--primary);
            border-radius: 8px;
            display: none; /* ·∫®n m·∫∑c ƒë·ªãnh */
            animation: fadeIn 0.5s;
        }

        .feedback-title { font-weight: bold; margin-bottom: 10px; color: #333; }
        
        .model-answer {
            background: #fff;
            padding: 15px;
            border: 1px dashed #ccc;
            border-radius: 8px;
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .keyword-check {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .tag {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: bold;
        }
        .tag.found { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .tag.missing { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }

        /* SVG Placeholder */
        .svg-placeholder {
            width: 100%;
            height: 200px;
            background: #fafafa;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 10px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Final Report */
        .report-screen {
            display: none;
            text-align: center;
            padding: 50px;
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>üìù Luy·ªán T·∫≠p: H√¨nh LƒÉng Tr·ª• (Tam Gi√°c & T·ª© Gi√°c)</h1>
        <div class="progress-container">
            C√¢u <span id="current-q">1</span> / <span id="total-q">4</span>
        </div>
    </header>

    <!-- M√ÄN H√åNH C√ÇU H·ªéI -->
    <div id="quiz-screen" class="main-content">
        <div class="question-box">
            <div class="q-title">
                <span id="q-icon">ü§î</span>
                <span id="q-title-text">C√¢u h·ªèi 1</span>
            </div>
            <div class="q-content" id="q-text">
                ƒêang t·∫£i c√¢u h·ªèi...
            </div>
            <!-- Ch·ªó ƒë·ªÉ h√¨nh ·∫£nh minh h·ªça -->
            <div id="q-visual" class="svg-placeholder"></div>
        </div>

        <div class="answer-area" id="input-container">
            <!-- S·∫Ω ƒë∆∞·ª£c ƒëi·ªÅn b·∫±ng JS: Textarea ho·∫∑c Template -->
        </div>

        <div class="feedback-section" id="feedback-area">
            <div class="feedback-title">üîç ƒê√°nh gi√° t·ª± ƒë·ªông:</div>
            <div class="keyword-check" id="keyword-list"></div>
            
            <div style="margin-top: 15px; font-weight: bold; color: #333;">ƒê√°p √°n tham kh·∫£o:</div>
            <div class="model-answer" id="model-answer"></div>
            
            <p style="font-size: 13px; color: #666; font-style: italic;">
                *H√£y so s√°nh k·∫øt qu·∫£ c·ªßa em v·ªõi ƒë√°p √°n m·∫´u.
            </p>
        </div>

        <div class="controls">
            <button class="btn-submit" id="btn-submit" onclick="submitAnswer()">Ki·ªÉm Tra K·∫øt Qu·∫£</button>
            <button class="btn-next" id="btn-next" onclick="nextQuestion()">C√¢u Ti·∫øp Theo ‚ûú</button>
        </div>
    </div>

    <!-- M√ÄN H√åNH K·∫æT TH√öC -->
    <div id="end-screen" class="report-screen">
        <h2 style="color: var(--success); font-size: 32px;">üéâ Ho√†n Th√†nh!</h2>
        <p>Em ƒë√£ ho√†n th√†nh b√†i luy·ªán t·∫≠p.</p>
        <div style="margin-top: 30px;">
            <button class="btn-export" onclick="downloadReport()">üì• T·∫£i B√°o C√°o K·∫øt Qu·∫£</button>
            <button class="btn-next" style="display:inline-block; background:#6c757d;" onclick="location.reload()">L√†m L·∫°i</button>
        </div>
    </div>
</div>

<script>
    // --- D·ªÆ LI·ªÜU C√ÇU H·ªéI ---
    // type: 'text' (t·ª± lu·∫≠n th∆∞·ªùng) ho·∫∑c 'template' (ƒëi·ªÅn s·ªë)
    const questions = [
        {
            id: 1,
            type: 'text',
            title: "Nh·∫≠n bi·∫øt h√¨nh kh·ªëi",
            text: "Quan s√°t m·ªôt h·ªôp s·ªØa t∆∞∆°i lo·∫°i 1 l√≠t (d·∫°ng h√¨nh h·ªôp ch·ªØ nh·∫≠t). H√£y m√¥ t·∫£ c√°c ƒë·∫∑c ƒëi·ªÉm c·ªßa n√≥: S·ªë m·∫∑t, s·ªë ƒë·ªânh, s·ªë c·∫°nh v√† h√¨nh d·∫°ng c·ªßa c√°c m·∫∑t.",
            svg: `<svg viewBox="0 0 200 200" width="180" height="180"><rect x="60" y="60" width="80" height="120" fill="#e3f2fd" stroke="#2c3e50" stroke-width="2"/><polyline points="60,60 90,30 170,30 170,150 140,180" fill="none" stroke="#2c3e50" stroke-width="2"/><line x1="140" y1="60" x2="170" y2="30" stroke="#2c3e50" stroke-width="2"/><line x1="140" y1="180" x2="140" y2="60" stroke="#2c3e50" stroke-width="2"/></svg>`,
            keywords: ["6 m·∫∑t", "8 ƒë·ªânh", "12 c·∫°nh", "ch·ªØ nh·∫≠t"],
            modelAnswer: "- H√¨nh h·ªôp ch·ªØ nh·∫≠t c√≥ 6 m·∫∑t, 8 ƒë·ªânh v√† 12 c·∫°nh.<br>- C√°c m·∫∑t ƒë·ªÅu l√† h√¨nh ch·ªØ nh·∫≠t.<br>- C√°c m·∫∑t ƒë·ªëi di·ªán song song v√† b·∫±ng nhau."
        },
        {
            id: 2,
            type: 'template',
            title: "LƒÉng Tr·ª• Tam Gi√°c",
            text: "M·ªôt lƒÉng tr·ª• ƒë·ª©ng ƒë√°y tam gi√°c vu√¥ng c√≥ hai c·∫°nh g√≥c vu√¥ng l√† 3cm, 4cm; c·∫°nh huy·ªÅn l√† 5cm. Chi·ªÅu cao lƒÉng tr·ª• l√† 10cm. H√£y ƒëi·ªÅn c√°c s·ªë th√≠ch h·ª£p ƒë·ªÉ t√≠nh di·ªán t√≠ch xung quanh.",
            svg: `<svg viewBox="0 0 200 150" width="200" height="150"><polygon points="20,120 80,120 20,80" fill="#ffe0b2" stroke="#e67e22" stroke-width="2"/><line x1="20" y1="120" x2="120" y2="70" stroke="#e67e22" stroke-width="2"/><line x1="80" y1="120" x2="180" y2="70" stroke="#e67e22" stroke-width="2"/><line x1="20" y1="80" x2="120" y2="30" stroke="#e67e22" stroke-width="2"/><polygon points="120,70 180,70 120,30" fill="#fff3e0" stroke="#e67e22" stroke-width="2"/></svg>`,
            // Template cho h·ªçc sinh ƒëi·ªÅn
            templateHtml: `
                <div class="fill-in-box">
                    <div class="fill-line">
                        1. Chu vi ƒë√°y = <input type="number" class="calc-input" data-idx="0"> cm
                    </div>
                    <div class="fill-line">
                        2. Di·ªán t√≠ch xung quanh = Chu vi ƒë√°y √ó <input type="number" class="calc-input" data-idx="1"> (chi·ªÅu cao)
                    </div>
                    <div class="fill-line">
                        = <input type="number" class="calc-input" data-idx="2"> cm¬≤
                    </div>
                </div>
            `,
            // Logic check: Gh√©p input th√†nh chu·ªói ƒë·ªÉ ki·ªÉm tra keyword
            keywords: ["12", "10", "120"], 
            modelAnswer: "Chu vi ƒë√°y = 3 + 4 + 5 = 12 (cm).<br>Di·ªán t√≠ch xung quanh = 12 x 10 = 120 (cm¬≤)."
        },
        {
            id: 3,
            type: 'template',
            title: "LƒÉng Tr·ª• T·ª© Gi√°c (B·ªÉ B∆°i)",
            text: "M·ªôt b·ªÉ b∆°i h√¨nh h·ªôp ch·ªØ nh·∫≠t c√≥ chi·ªÅu d√†i 4m, chi·ªÅu r·ªông 2m v√† chi·ªÅu s√¢u 1.5m. H√£y t√≠nh th·ªÉ t√≠ch n∆∞·ªõc t·ªëi ƒëa b·ªÉ ch·ª©a ƒë∆∞·ª£c.",
            svg: `<svg viewBox="0 0 200 150" width="200" height="150"><path d="M20,50 L120,50 L100,100 L0,100 Z" fill="#b3e5fc" stroke="#0288d1" stroke-width="2"/><line x1="0" y1="100" x2="0" y2="140" stroke="#0288d1" stroke-width="2"/><line x1="100" y1="100" x2="100" y2="140" stroke="#0288d1" stroke-width="2"/><line x1="120" y1="50" x2="120" y2="90" stroke="#0288d1" stroke-width="2"/><path d="M0,140 L100,140 L120,90" fill="none" stroke="#0288d1" stroke-width="2"/></svg>`,
            templateHtml: `
                <div class="fill-in-box">
                    <div class="fill-line">
                        C√¥ng th·ª©c th·ªÉ t√≠ch V = D√†i √ó R·ªông √ó Cao
                    </div>
                    <div class="fill-line">
                        V = <input type="number" class="calc-input" data-idx="0"> √ó <input type="number" class="calc-input" data-idx="1"> √ó <input type="number" class="calc-input" data-idx="2">
                    </div>
                    <div class="fill-line">
                        K·∫øt qu·∫£ = <input type="number" class="calc-input" data-idx="3"> m¬≥
                    </div>
                </div>
            `,
            keywords: ["4", "2", "1.5", "12"],
            modelAnswer: "Th·ªÉ t√≠ch V = 4 x 2 x 1.5 = 12 (m¬≥)."
        },
        {
            id: 4,
            type: 'template',
            title: "Di·ªán T√≠ch To√†n Ph·∫ßn (LƒÉng Tr·ª• T·ª© Gi√°c)",
            text: "M·ªôt kh·ªëi g·ªó h√¨nh h·ªôp ch·ªØ nh·∫≠t c√≥ ƒë√°y l√† h√¨nh vu√¥ng c·∫°nh 2cm, chi·ªÅu cao lƒÉng tr·ª• l√† 1cm. H√£y t√≠nh di·ªán t√≠ch to√†n ph·∫ßn c·ªßa kh·ªëi g·ªó n√†y. (G·ª£i √Ω: T√≠nh S_xq r·ªìi c·ªông v·ªõi 2 l·∫ßn S_ƒë√°y).",
            svg: `<svg viewBox="0 0 200 200" width="150" height="150">
                <!-- H√¨nh h·ªôp ch·ªØ nh·∫≠t th·∫•p -->
                <rect x="50" y="80" width="100" height="40" fill="#a1887f" stroke="#5d4037" stroke-width="2"/>
                <polygon points="50,80 80,50 180,50 150,80" fill="#d7ccc8" stroke="#5d4037" stroke-width="2"/>
                <line x1="180" y1="50" x2="180" y2="90" stroke="#5d4037" stroke-width="2"/>
                <line x1="150" y1="120" x2="180" y2="90" stroke="#5d4037" stroke-width="2"/>
                <line x1="80" y1="50" x2="80" y2="90" stroke="#5d4037" stroke-width="2" stroke-dasharray="4"/>
                <line x1="50" y1="120" x2="80" y2="90" stroke="#5d4037" stroke-width="2" stroke-dasharray="4"/>
                <line x1="80" y1="90" x2="180" y2="90" stroke="#5d4037" stroke-width="2" stroke-dasharray="4"/>
            </svg>`,
            templateHtml: `
                <div class="fill-in-box">
                    <div class="fill-line">
                        1. Chu vi ƒë√°y = 2 x 4 = <input type="number" class="calc-input" data-idx="0"> cm
                    </div>
                    <div class="fill-line">
                        2. Di·ªán t√≠ch xung quanh = <input type="number" class="calc-input" data-idx="1"> cm¬≤
                    </div>
                    <div class="fill-line">
                        3. Di·ªán t√≠ch 1 m·∫∑t ƒë√°y = 2 x 2 = <input type="number" class="calc-input" data-idx="2"> cm¬≤
                    </div>
                    <div class="fill-line">
                        4. <strong>Di·ªán t√≠ch to√†n ph·∫ßn :</strong> <input type="number" class="calc-input" data-idx="3"> cm^2
                    </div>
                </div>
            `,
            // ·ªû ƒë√¢y ta s·ª≠ d·ª•ng keyword ƒë·∫∑c bi·ªát ƒë·ªÉ kh·ªõp c·∫£ c√¢u nh∆∞ y√™u c·∫ßu
            keywords: ["di·ªán t√≠ch to√†n ph·∫ßn : 16cm^2"],
            modelAnswer: "Chu vi ƒë√°y = 8cm.<br>S_xq = 8 x 1 = 8cm¬≤.<br>S_ƒë√°y = 4cm¬≤.<br>Di·ªán t√≠ch to√†n ph·∫ßn = 8 + 2x4 = 16cm¬≤."
        }
    ];

    let currentIdx = 0;
    let userAnswers = []; 

    // --- KH·ªûI T·∫†O ---
    function loadQuestion() {
        const q = questions[currentIdx];
        
        document.getElementById('current-q').innerText = currentIdx + 1;
        document.getElementById('total-q').innerText = questions.length;
        
        document.getElementById('q-title-text').innerText = `C√¢u ${currentIdx + 1}: ${q.title}`;
        document.getElementById('q-text').innerText = q.text;
        document.getElementById('q-visual').innerHTML = q.svg;
        
        // Render v√πng nh·∫≠p li·ªáu
        const inputContainer = document.getElementById('input-container');
        inputContainer.innerHTML = ''; // Clear c≈©

        if (q.type === 'template') {
            // Render template ƒëi·ªÅn s·ªë
            const div = document.createElement('div');
            div.innerHTML = `<label>ƒêi·ªÅn s·ªë th√≠ch h·ª£p v√†o √¥ tr·ªëng:</label>` + q.templateHtml;
            inputContainer.appendChild(div);
        } else {
            // Render textarea th∆∞·ªùng
            inputContainer.innerHTML = `
                <label for="user-answer">B√†i l√†m c·ªßa em:</label>
                <textarea id="user-answer" placeholder="Nh·∫≠p c√¢u tr·∫£ l·ªùi chi ti·∫øt..."></textarea>
            `;
        }

        // Reset UI Feedback
        document.getElementById('feedback-area').style.display = 'none';
        document.getElementById('btn-submit').style.display = 'block';
        document.getElementById('btn-next').style.display = 'none';
    }

    // --- X·ª¨ L√ù N·ªòP B√ÄI ---
    function submitAnswer() {
        const q = questions[currentIdx];
        let userAnswerContent = "";
        let rawCheckString = ""; // Chu·ªói d√πng ƒë·ªÉ so kh·ªõp t·ª´ kh√≥a

        // L·∫•y d·ªØ li·ªáu t·ª´ User
        if (q.type === 'template') {
            // Thu th·∫≠p t·∫•t c·∫£ inputs
            const inputs = document.querySelectorAll('.calc-input');
            let allFilled = true;
            let values = [];
            
            inputs.forEach(inp => {
                if(!inp.value) allFilled = false;
                values.push(inp.value.trim());
            });

            if(!allFilled) {
                alert("Em h√£y ƒëi·ªÅn ƒë·∫ßy ƒë·ªß c√°c √¥ tr·ªëng nh√©!");
                return;
            }
            
            // X·ª≠ l√Ω ri√™ng cho C√¢u 4 ƒë·ªÉ t·∫°o chu·ªói "Di·ªán t√≠ch to√†n ph·∫ßn : 16cm^2"
            if (q.id === 4) {
                 // Format c√¢u tr·∫£ l·ªùi ƒë·ªÉ hi·ªÉn th·ªã trong b√°o c√°o
                userAnswerContent = `Chu vi: ${values[0]}, S_xq: ${values[1]}, S_ƒë√°y: ${values[2]} \n=> Di·ªán t√≠ch to√†n ph·∫ßn : ${values[3]}cm^2`;
                // Chu·ªói d√πng ƒë·ªÉ check keyword (ƒë√∫ng format y√™u c·∫ßu)
                rawCheckString = `di·ªán t√≠ch to√†n ph·∫ßn : ${values[3]}cm^2`; 
            } else {
                // C√°c c√¢u kh√°c ch·ªâ c·∫ßn check s·ª± xu·∫•t hi·ªán c·ªßa s·ªë
                userAnswerContent = values.join(" | ");
                rawCheckString = values.join(" ");
            }

        } else {
            // L·∫•y t·ª´ Textarea
            const val = document.getElementById('user-answer').value.trim();
            if(!val) {
                alert("Em h√£y nh·∫≠p c√¢u tr·∫£ l·ªùi nh√©!");
                return;
            }
            userAnswerContent = val;
            rawCheckString = val;
        }

        // L∆∞u b√†i l√†m
        userAnswers[currentIdx] = userAnswerContent;

        // --- LOGIC CH·∫§M ---
        const feedbackArea = document.getElementById('feedback-area');
        const keywordList = document.getElementById('keyword-list');
        const modelAns = document.getElementById('model-answer');

        let htmlTags = "";
        q.keywords.forEach(kw => {
            // So kh·ªõp kh√¥ng ph√¢n bi·ªát hoa th∆∞·ªùng
            // V·ªõi c√¢u 4, rawCheckString l√† "di·ªán t√≠ch to√†n ph·∫ßn : 16cm^2"
            // Keyword c≈©ng l√† "di·ªán t√≠ch to√†n ph·∫ßn : 16cm^2" -> s·∫Ω kh·ªõp c·∫£ c√¢u
            if(rawCheckString.toLowerCase().includes(kw.toLowerCase())) {
                htmlTags += `<span class="tag found">‚úÖ Ch√≠nh x√°c: "${kw}"</span>`;
            } else {
                htmlTags += `<span class="tag missing">‚ùå Ch∆∞a kh·ªõp: "${kw}"</span>`;
            }
        });

        keywordList.innerHTML = htmlTags;
        modelAns.innerHTML = q.modelAnswer;

        // Hi·ªÉn th·ªã k·∫øt qu·∫£
        feedbackArea.style.display = 'block';
        document.getElementById('btn-submit').style.display = 'none';
        
        const btnNext = document.getElementById('btn-next');
        btnNext.style.display = 'block';
        if(currentIdx === questions.length - 1) {
            btnNext.innerText = "Xem K·∫øt Qu·∫£ T·ªïng H·ª£p üèÅ";
        } else {
            btnNext.innerText = "C√¢u Ti·∫øp Theo ‚ûú";
        }
    }

    // --- CHUY·ªÇN C√ÇU ---
    function nextQuestion() {
        if(currentIdx < questions.length - 1) {
            currentIdx++;
            loadQuestion();
        } else {
            showEndScreen();
        }
    }

    function showEndScreen() {
        document.getElementById('quiz-screen').style.display = 'none';
        document.getElementById('end-screen').style.display = 'block';
    }

    function downloadReport() {
        let content = "B√ÅO C√ÅO K·∫æT QU·∫¢ LUY·ªÜN T·∫¨P\n";
        content += "M√¥n: H√¨nh h·ªçc 7 - LƒÉng Tr·ª• ƒê·ª©ng\n";
        content += "Th·ªùi gian: " + new Date().toLocaleString() + "\n\n";
        content += "----------------------------------------\n";

        questions.forEach((q, i) => {
            content += `C√ÇU ${i+1}: ${q.title}\n`;
            content += `[B√†i l√†m c·ªßa em]: ${userAnswers[i] || "Ch∆∞a l√†m"}\n`;
            content += "----------------------------------------\n";
        });

        const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = `Ket_Qua_Hinh_Hoc_${Date.now()}.txt`;
        link.click();
    }

    // Start App
    loadQuestion();

</script>

</body>
</html>